substitutions:
  devicename: ball_1

esphome:
  name: light
  platform: ESP8266
  board: esp01_1m
  includes:
  - lib/MeshRC.h
  - lib/esp_now_light.h
  libraries:
  - ESP8266WiFi

light:
  - platform: fastled_clockless
    chipset: WS2812B
    pin: RX
    num_leds: 16
    rgb_order: GRB
    id: light_1
    effects:
      - addressable_rainbow:
          name: "Addressable 1 (Rainbow)"
          speed: 5
      - addressable_color_wipe:
          name: "Addressable 2 (Color Wipe)"
          add_led_interval: 300ms
      - addressable_scan:
          name: "Addressable 3 (Scan)"
          move_interval: 50ms
      - addressable_twinkle:
          name: "Addressable 4 (Twinkle)"
          progress_interval: 20ms
          twinkle_probability: 3%
      - addressable_random_twinkle:
          name: "Addressable 5 (Random Twinkle)"
          progress_interval: 50ms
          twinkle_probability: 20%
      - addressable_fireworks:
          name: "Addressable 6 (Fireworks)"
          fade_out_rate: 160
      - addressable_fireworks:
          name: "Addressable 7 (Random Fireworks)"
          use_random_color: true
          spark_probability: 15%
      - random: 
          name: "Fade"
          transition_length: 3s
          update_interval: 10s
      - strobe:
          name: "Strobe"
          colors:
            - state: true
              duration: 150ms
            - state: false
              duration: 150ms
      - strobe:
          name: "Strobe (RGB)"
          colors:
            - state: true
              red: 100%
              green: 0%
              blue: 0%
              duration: 100ms
            - state: true
              red: 0%
              green: 100%
              blue: 0%
              duration: 100ms
            - state: true
              red: 0%
              green: 0%
              blue: 100%
              duration: 100ms
            - state: false
              duration: 100ms

wifi:
  ap:
    ssid: light_ball
    password: !secret wifipassliot
    channel: 7
    id: wifiap

ota: 

logger:

custom_component:
- lambda: |-
    MeshRC::begin();
    
    ESP_LOGD("custom", "Initialising MeshRC");
    
    MeshRC::on("", [](u8* data, u8 size) {
      // Process an incomming message, if it is directed to us, then we handle it.
      ESP_LOGD("custom", "Receiving any MeshRC message");
      u8 dest[6];
      get_mac_address_raw(dest);
      if (size > 6 && MeshRC::equals(data, dest, 6) && (data[6] == '>')) {
          u8* newData = &data[5];
          ESP_LOGD("custom", "Receiving meshRC message");
          newData[0] = '#';
          MeshRC::recvHandler(MeshRC::sender, newData, size - 5);
          // MeshRC::send("#<OK");
      }
    });
    
    MeshRC::on("#>SET", [](u8* data, u8 size) {
      float red, green, blue, brightness;
      
      ESP_LOGD("custom", "Receiving Light command");
      
      String values = "";
      for (auto i=0; i<size; i++) 
        values.concat((const char)data[i]);
      
      int pos;
    	pos = values.indexOf(';');
    	red = values.substring(0, pos).toFloat();
    	values.remove(0, pos+1);
    	
    	pos = values.indexOf(';');
    	green = values.substring(0, pos).toFloat();
    	values.remove(0, pos+1);
    	
    	pos = values.indexOf(';');
    	blue = values.substring(0, pos).toFloat();
    	values.remove(0, pos+1);
    	
    	pos = values.indexOf(';');
    	brightness = values.substring(0, pos).toFloat();
    	values.remove(0, pos+1);
    	
    	pos = values.indexOf(';');
  
      auto call = id(light_1).turn_on();
      call.set_rgb(red, green, blue);
      call.set_brightness(brightness); 
      call.set_effect(values.substring(0, pos).c_str());
      call.perform();
    });
    return {};
